<html>
<head>
    <title>Home Page</title>

    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>

    <!-- Don't use this in production: -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body>

<div id="root"></div>
<script type="text/babel">

    const items = <%- cars %>;
    console.log(items)

    // define other components

class CarRow extends React.Component {
  constructor(props) {
    super(props);
  }

  render() {
    const car = this.props.car;
    const name = car.name;
    const url = "/detail?name=" + name;

    return (
      <tr>
        <td><a href={url}>{name}</a></td>
      </tr>
    );
  }
}

class CarTable extends React.Component {
  constructor(props) {
    super(props);
  }

  render() {
    const rows = [];

    this.props.cars.forEach((car) => {
      rows.push(
        <CarRow
          car={car}
          key={car._id}
        />
      );
    });

    return (
      <table>
        <thead>
          <tr>
            <th>Car Name</th>
          </tr>
        </thead>
        <tbody>{rows}</tbody>
      </table>
    );
  }
}

class CarList extends React.Component {
  constructor(props) {
    super(props);
  }

  render() {
    return (
      <div>
        <CarTable
          cars={this.props.cars}
        />
      </div>
    );
  }
}

const Cars = (props) => {
  const listCars = props.data.map((car) =>
  <li key={car._id} id={car.id} onClick={props.clickHandler}>
      {car.name}
  </li>);
  return <ul>{listCars}</ul>
}

const CarDetail = (props) => {
  return <div>Detail<hr/>
    <form>
      Brand: <input type="text" name="brand" onChange={props.handleChange} value={props.car.brand || ""} /><br />
      Name: <input type="text" name="name" onChange={props.handleChange} value={props.car.name || ""} /><br />
      Horsepower: <input type="number" name="hp" onChange={props.handleChange} value={props.car.horsepower || ""} /><br />
      Price: <input type="number" name="price" onChange={props.handleChange} value={props.car.price || ""} /><br />
      <button onClick={props.clearForm}>Clear</button>
    </form>
    </div>
}

class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      cars : <%- cars %>,
      currentCar: {} 
    };
    //this.selectItem = this.selectItem.bind(this);
  }

  showDetail = (event) => {
    let title = event.target.innerText;
    let newItem = this.state.cars.find((car) => car.name == title);
    this.setState({"currentCar": newItem})
  }

  fieldChanged = (event) => {
    let newItem = this.state.currentCar;
    console.log(event.target.value)
    newItem[event.target.name] = event.target.value;
    this.setState({currentCar: newItem})
  }

  clearForm = () => {
    this.setState({brand:"", name: "", horsepower: "", price: ""});
  }

  render() {
    return (
      <div>
        <h2>Car List</h2>
        <Cars data={this.state.cars} clickHandler={this.showDetail} />
        <CarDetail 
          car={this.state.currentCar} handleChange={this.fieldChanged} onClick={this.clearForm}
          />
      </div>
    );
  }
}

//ReactDOM.render(<CarList cars={items} />, document.getElementById('root'));
ReactDOM.render(<App />, document.getElementById('root'));

</script>
</body>
</html>